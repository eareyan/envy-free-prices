CREATE TABLE unit_demand (
	n integer NOT NULL,
	m integer NOT NULL,
	p double precision NOT NULL,
	ckEfficiency double precision NOT NULL,
	ckRevenue double precision NOT NULL,
	ckTime double precision NOT NULL,
	ckWE1 double precision NOT NULL,
	ckWE2 double precision NOT NULL,
	evpEfficiency double precision NOT NULL,
	evpRevenue double precision NOT NULL,
	evpTime double precision NOT NULL,
	evpWE1 double precision NOT NULL,
	evpWE2 double precision NOT NULL,
	mweqEfficiency double precision NOT NULL,
	mweqRevenue double precision NOT NULL,
	mweqTime double precision NOT NULL,
	mweqWE1 double precision NOT NULL,
	mweqWE2 double precision NOT NULL
	);

CREATE TABLE unit_uniform_demand (
	n integer NOT NULL,
	m integer NOT NULL,
	p double precision NOT NULL,
	ckEfficiency double precision NOT NULL,
	ckRevenue double precision NOT NULL,
	ckTime double precision NOT NULL,
	ckWE1 double precision NOT NULL,
	ckWE2 double precision NOT NULL,
	evpEfficiency double precision NOT NULL,
	evpRevenue double precision NOT NULL,
	evpTime double precision NOT NULL,
	evpWE1 double precision NOT NULL,
	evpWE2 double precision NOT NULL,
	mweqEfficiency double precision NOT NULL,
	mweqRevenue double precision NOT NULL,
	mweqTime double precision NOT NULL,
	mweqWE1 double precision NOT NULL,
	mweqWE2 double precision NOT NULL,
	lpEfficiency double precision NOT NULL,
	lpRevenue double precision NOT NULL,
	lpTime double precision NOT NULL,
	lpWE1 double precision NOT NULL,
	lpWE2 double precision NOT NULL
	);

CREATE TABLE fancy_underdemand (
	n integer NOT NULL,
	m integer NOT NULL,
	p double precision NOT NULL,
	b integer NOT NULL,
	ckEfficiency double precision NOT NULL,
	ckRevenue double precision NOT NULL,
	ckTime double precision NOT NULL,
	ckWE1 double precision NOT NULL,
	ckWE2 double precision NOT NULL,
	lpOptEfficiency double precision NOT NULL,
	lpOptRevenue double precision NOT NULL,
	lpOptTime double precision NOT NULL,
	lpOptWE1 double precision NOT NULL,
	lpOptWE2 double precision NOT NULL,
	lpWFEfficiency double precision NOT NULL,
	lpWFRevenue double precision NOT NULL,
	lpWFTime double precision NOT NULL,
	lpWFWE1 double precision NOT NULL,
	lpWFWE2 double precision NOT NULL,
	lpG1Efficiency double precision NOT NULL,
	lpG1Revenue double precision NOT NULL,
	lpG1Time double precision NOT NULL,
	lpG1WE1 double precision NOT NULL,
	lpG1WE2 double precision NOT NULL,
	lpG2Efficiency double precision NOT NULL,
	lpG2Revenue double precision NOT NULL,
	lpG2Time double precision NOT NULL,
	lpG2WE1 double precision NOT NULL,
	lpG2WE2 double precision NOT NULL
	);


CREATE TABLE fancy_unitsupply_underdemand (
	n integer NOT NULL,
	m integer NOT NULL,
	p double precision NOT NULL,
	b integer NOT NULL,
	lpOptEfficiency double precision NOT NULL,
	lpOptRevenue double precision NOT NULL,
	lpOptTime double precision NOT NULL,
	lpOptWE1 double precision NOT NULL,
	lpOptWE2 double precision NOT NULL,
	lpWFEfficiency double precision NOT NULL,
	lpWFRevenue double precision NOT NULL,
	lpWFTime double precision NOT NULL,
	lpWFWE1 double precision NOT NULL,
	lpWFWE2 double precision NOT NULL,
	lpG1Efficiency double precision NOT NULL,
	lpG1Revenue double precision NOT NULL,
	lpG1Time double precision NOT NULL,
	lpG1WE1 double precision NOT NULL,
	lpG1WE2 double precision NOT NULL,
	lpG2Efficiency double precision NOT NULL,
	lpG2Revenue double precision NOT NULL,
	lpG2Time double precision NOT NULL,
	lpG2WE1 double precision NOT NULL,
	lpG2WE2 double precision NOT NULL
	);

CREATE TABLE fancy_overdemand (
	n integer NOT NULL,
	m integer NOT NULL,
	p double precision NOT NULL,
	b integer NOT NULL,
	ckEfficiency double precision NOT NULL,
	ckRevenue double precision NOT NULL,
	ckTime double precision NOT NULL,
	ckWE1 double precision NOT NULL,
	ckWE2 double precision NOT NULL,
	lpOptEfficiency double precision NOT NULL,
	lpOptRevenue double precision NOT NULL,
	lpOptTime double precision NOT NULL,
	lpOptWE1 double precision NOT NULL,
	lpOptWE2 double precision NOT NULL,
	lpWFEfficiency double precision NOT NULL,
	lpWFRevenue double precision NOT NULL,
	lpWFTime double precision NOT NULL,
	lpWFWE1 double precision NOT NULL,
	lpWFWE2 double precision NOT NULL,
	lpG1Efficiency double precision NOT NULL,
	lpG1Revenue double precision NOT NULL,
	lpG1Time double precision NOT NULL,
	lpG1WE1 double precision NOT NULL,
	lpG1WE2 double precision NOT NULL,
	lpG2Efficiency double precision NOT NULL,
	lpG2Revenue double precision NOT NULL,
	lpG2Time double precision NOT NULL,
	lpG2WE1 double precision NOT NULL,
	lpG2WE2 double precision NOT NULL
	);

CREATE TABLE fancy_unitsupply_overdemand (
	n integer NOT NULL,
	m integer NOT NULL,
	p double precision NOT NULL,
	b integer NOT NULL,
	lpOptEfficiency double precision NOT NULL,
	lpOptRevenue double precision NOT NULL,
	lpOptTime double precision NOT NULL,
	lpOptWE1 double precision NOT NULL,
	lpOptWE2 double precision NOT NULL,
	lpWFEfficiency double precision NOT NULL,
	lpWFRevenue double precision NOT NULL,
	lpWFTime double precision NOT NULL,
	lpWFWE1 double precision NOT NULL,
	lpWFWE2 double precision NOT NULL,
	lpG1Efficiency double precision NOT NULL,
	lpG1Revenue double precision NOT NULL,
	lpG1Time double precision NOT NULL,
	lpG1WE1 double precision NOT NULL,
	lpG1WE2 double precision NOT NULL,
	lpG2Efficiency double precision NOT NULL,
	lpG2Revenue double precision NOT NULL,
	lpG2Time double precision NOT NULL,
	lpG2WE1 double precision NOT NULL,
	lpG2WE2 double precision NOT NULL
	);


CREATE TABLE allocation (
	n integer NOT NULL,
	m integer NOT NULL,
	p double precision NOT NULL,
	greedyToEfficient double precision NOT NULL,
	wfToEfficient double precision NOT NULL,
	wfToGreedy double precision NOT NULL
	);

CREATE TABLE singleminded (
	n integer NOT NULL,
	m integer NOT NULL,
	approxWelfare double precision NOT NULL,
	approxRevenue double precision NOT NULL,
	approxEF double precision NOT NULL,
	approxMC double precision NOT NULL,
	approxTime double precision NOT NULL,
	gwWelfare double precision NOT NULL,
	gwRevenue double precision NOT NULL,
	gwEF double precision NOT NULL,
	gwMC double precision NOT NULL,
	gwTime double precision NOT NULL,
	geWelfare double precision NOT NULL,
	geRevenue double precision NOT NULL,
	geEF double precision NOT NULL,
	geMC double precision NOT NULL,
	geTime double precision NOT NULL,
	owWelfare double precision NOT NULL,
	owRevenue double precision NOT NULL,
	owEF double precision NOT NULL,
	owMC double precision NOT NULL,
	owTime double precision NOT NULL,
	oeWelfare double precision NOT NULL,
	oeRevenue double precision NOT NULL,
	oeEF double precision NOT NULL,
	oeMC double precision NOT NULL,
	oeTime double precision NOT NULL
	);
	
CREATE TABLE tacexperiments (
	m integer NOT NULL,
	p double precision NOT NULL,
	greedyWelfare double precision NOT NULL,
	greedyRevenue double precision NOT NULL,
	greedyEF double precision NOT NULL,
	greedyWE double precision NOT NULL,
	greedyTime double precision NOT NULL,
	optimaWelfare double precision NOT NULL,
	optimaRevenue double precision NOT NULL,
	optimaEF double precision NOT NULL,
	optimaWE double precision NOT NULL,
	optimaTime double precision NOT NULL
	);

\copy (SELECT * FROM unit_demand ORDER BY n,m,p) to '/home/eareyanv/workspace/envy-free-prices/results/results-unit_demand.csv' csv header
\copy (SELECT * FROM unit_uniform_demand ORDER BY n,m,p) to '/home/eareyanv/workspace/envy-free-prices/results/results-unit_uniform_demand.csv' csv header

\copy (SELECT lpReservePriceRevenue / evpAppRevenue FROM unit_uniform_demand WHERE lpReservePriceRevenue >= evpAppRevenue AND p=0.25) to '/home/eareyanv/workspace/envy-free-prices/results/unit-uniform-demand/lpBiggerEqualevpapp-p25.csv' csv header

\copy tacexperiments to '/home/eareyanv/workspace/envy-free-prices/results/results-tac_demand.csv' csv header

\copy unit_demand to '/home/eareyanv/workspace/envy-free-prices/results/results-unit_demand.csv' csv header
\copy unit_uniform_demand to '/home/eareyanv/workspace/envy-free-prices/results/results-unit_uniform_demand.csv' csv header


\copy fancy_underdemand to '/home/eareyanv/workspace/envy-free-prices/results/results-fancy_underdemand.csv' csv header
\copy fancy_overdemand to '/home/eareyanv/workspace/envy-free-prices/results/results-fancy_overdemand.csv' csv header

SELECT n,m,p,ckEfficiency,ckRevenue,ckTime,ckWE1,ckWE2,ck2Efficiency,ck2Revenue,ck2Time,ck2WE1,ck2WE2 FROM fancy_underdemand;
SELECT n,m,p,ckEfficiency,ckRevenue,ckTime,ckWE1,ckWE2,ck2Efficiency,ck2Revenue,ck2Time,ck2WE1,ck2WE2 FROM fancy_overdemand;
SELECT n,m,p, lprevenue, evprevenue FROM unit_uniform_demand WHERE lprevenue > evprevenue;


\copy (SELECT n,m,approxWelfare,approxEF FROM singleminded WHERE n = 50) to '/home/eareyanv/workspace/envy-free-prices/results/latex/approxAlgo.csv' csv header


\copy (SELECT m,approxWelfare,approxEF,gwwelfare,gwef,gewelfare,geef,owwelfare,owef,oewelfare,oeef FROM singleminded WHERE n = 50) to '/home/eareyanv/workspace/envy-free-prices/results/latex/50items.csv' csv header

\copy (SELECT n,approxWelfare,approxEF,gwwelfare,gwef,gewelfare,geef,owwelfare,owef,oewelfare,oeef FROM singleminded WHERE m = 50) to '/home/eareyanv/workspace/envy-free-prices/results/latex/50bidders.csv' csv header

SELECT 	AVG(approxWelfare) AS approxWelfare, 
	AVG(approxRevenue) AS approxRevenue,
	AVG(approxEF) AS approxEF,
	AVG(approxWE) AS approxWE,
	AVG(approxTime) AS approxTime,
	AVG(greedyWelfare) AS greedyWelfare, 
	AVG(greedyRevenue) AS greedyRevenue,
	AVG(greedyEF) AS greedyEF,
	AVG(greedyWE) AS greedyWE,
	AVG(greedyTime) AS greedyTime
	FROM singleminded;

SELECT 	round(AVG(approxWelfare)::numeric,2) AS approxWelfare, 
	round(AVG(approxEF)::numeric,2) AS approxEF,
	round(AVG(approxTime)::numeric,2) AS approxTime,
	round(AVG(greedyWelfare)::numeric,2) AS greedyWelfare, 
	round(AVG(greedyEF)::numeric,2) AS greedyEF,
	round(AVG(greedyTime)::numeric,2) AS greedyTime
	FROM singleminded;


##### Single Minded #########


SELECT 	round(AVG(approxWelfare)::numeric,4) AS approxWelfare, 
	round(AVG(approxEF)::numeric,4) AS approxEF,
	round(AVG(approxTime)::numeric,4) AS approxTime,
	round(AVG(gwWelfare)::numeric,4) AS gwWelfare, 
	round(AVG(gwEF)::numeric,4) AS gwEF,
	round(AVG(gwTime)::numeric,4) AS gwTime,
	round(AVG(geWelfare)::numeric,4) AS geWelfare, 
	round(AVG(geEF)::numeric,4) AS geEF,
	round(AVG(geTime)::numeric,4) AS geTime,
	round(AVG(owWelfare)::numeric,4) AS owWelfare, 
	round(AVG(owEF)::numeric,4) AS owEF,
	round(AVG(owTime)::numeric,4) AS owTime,
	round(AVG(oeWelfare)::numeric,4) AS oeWelfare,
	round(AVG(oeEF)::numeric,4) AS oeEF,
	round(AVG(oeTime)::numeric,4) AS oeTime
	FROM singleminded
	WHERE n < m;

SELECT 	round(AVG(approxWelfare)::numeric,4) AS approxWelfare, 
	round(AVG(approxEF)::numeric,4) AS approxEF,
	round(AVG(approxTime)::numeric,4) AS approxTime,
	round(AVG(gwWelfare)::numeric,4) AS gwWelfare, 
	round(AVG(gwEF)::numeric,4) AS gwEF,
	round(AVG(gwTime)::numeric,4) AS gwTime,
	round(AVG(geWelfare)::numeric,4) AS geWelfare, 
	round(AVG(geEF)::numeric,4) AS geEF,
	round(AVG(geTime)::numeric,4) AS geTime,
	round(AVG(owWelfare)::numeric,4) AS owWelfare, 
	round(AVG(owEF)::numeric,4) AS owEF,
	round(AVG(owTime)::numeric,4) AS owTime,
	round(AVG(oeWelfare)::numeric,4) AS oeWelfare,
	round(AVG(oeEF)::numeric,4) AS oeEF,
	round(AVG(oeTime)::numeric,4) AS oeTime
	FROM singleminded
	WHERE n>m AND n <= 45 AND m <= 45;



##### TAC Experiments ####
SELECT 	round(AVG(greedyWelfare)::numeric,4) AS greedyWelfare, 
	round(AVG(greedyRevenue)::numeric,4) AS greedyRevenue,
	round(AVG(greedyEF)::numeric,4) AS greedyEF,
	round(AVG(greedyWE)::numeric,4) AS greedyWE, 
	round(AVG(greedyTime)::numeric,4) AS greedyTime
	FROM tacexperiments WHERE p = 0.25 OR p = 0.5 AND m < 10;

SELECT 	round(AVG(optimaWelfare)::numeric,4) AS optimaWelfare, 
	round(AVG(optimaRevenue)::numeric,4) AS optimaRevenue,
	round(AVG(optimaEF)::numeric,4) AS optimaEF,
	round(AVG(optimaWE)::numeric,4) AS optimaWE, 
	round(AVG(optimaTime)::numeric,4) AS optimaTime
	FROM tacexperiments WHERE p = 0.25 OR p = 0.5 AND m <10;

SELECT 	round(AVG(greedyWelfare)::numeric,4) AS greedyWelfare, 
	round(AVG(greedyRevenue)::numeric,4) AS greedyRevenue,
	round(AVG(greedyEF)::numeric,4) AS greedyEF,
	round(AVG(greedyWE)::numeric,4) AS greedyWE, 
	round(AVG(greedyTime)::numeric,4) AS greedyTime
	FROM tacexperiments WHERE p = 0.75 OR p = 1.0 AND m < 10;

SELECT 	round(AVG(optimaWelfare)::numeric,4) AS optimaWelfare, 
	round(AVG(optimaRevenue)::numeric,4) AS optimaRevenue,
	round(AVG(optimaEF)::numeric,4) AS optimaEF,
	round(AVG(optimaWE)::numeric,4) AS optimaWE, 
	round(AVG(optimaTime)::numeric,4) AS optimaTime
	FROM tacexperiments WHERE p = 0.75 OR p = 1.0 AND m < 10;





SELECT 	round(AVG(greedyWelfare)::numeric,4) AS greedyWelfare, 
	round(AVG(greedyRevenue)::numeric,4) AS greedyRevenue,
	round(AVG(greedyEF)::numeric,4) AS greedyEF,
	round(AVG(greedyWE)::numeric,4) AS greedyWE, 
	round(AVG(greedyTime)::numeric,4) AS greedyTime
	FROM tacexperiments WHERE p = 0.25 OR p = 0.5 AND m >= 10;

SELECT 	round(AVG(optimaWelfare)::numeric,4) AS optimaWelfare, 
	round(AVG(optimaRevenue)::numeric,4) AS optimaRevenue,
	round(AVG(optimaEF)::numeric,4) AS optimaEF,
	round(AVG(optimaWE)::numeric,4) AS optimaWE, 
	round(AVG(optimaTime)::numeric,4) AS optimaTime
	FROM tacexperiments WHERE p = 0.25 OR p = 0.5 AND m >= 10;

SELECT 	round(AVG(greedyWelfare)::numeric,4) AS greedyWelfare, 
	round(AVG(greedyRevenue)::numeric,4) AS greedyRevenue,
	round(AVG(greedyEF)::numeric,4) AS greedyEF,
	round(AVG(greedyWE)::numeric,4) AS greedyWE, 
	round(AVG(greedyTime)::numeric,4) AS greedyTime
	FROM tacexperiments WHERE p = 0.75 OR p = 1.0 AND m >= 10;

SELECT 	round(AVG(optimaWelfare)::numeric,4) AS optimaWelfare, 
	round(AVG(optimaRevenue)::numeric,4) AS optimaRevenue,
	round(AVG(optimaEF)::numeric,4) AS optimaEF,
	round(AVG(optimaWE)::numeric,4) AS optimaWE, 
	round(AVG(optimaTime)::numeric,4) AS optimaTime
	FROM tacexperiments WHERE p = 0.75 OR p = 1.0 AND m >= 10;


SELECT 	round(AVG(greedyWelfare)::numeric,4) AS greedyWelfare, 
	round(AVG(greedyRevenue)::numeric,4) AS greedyRevenue,
	round(AVG(greedyEF)::numeric,4) AS greedyEF,
	round(AVG(greedyWE)::numeric,4) AS greedyWE, 
	round(AVG(greedyTime)::numeric,4) AS greedyTime,
	round(AVG(optimaWelfare)::numeric,4) AS optimaWelfare, 
	round(AVG(optimaRevenue)::numeric,4) AS optimaRevenue,
	round(AVG(optimaEF)::numeric,4) AS optimaEF,
	round(AVG(optimaWE)::numeric,4) AS optimaWE, 
	round(AVG(optimaTime)::numeric,4) AS optimaTime
	FROM tacexperiments;

